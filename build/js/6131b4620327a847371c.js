!function(i){var n={};function a(t){if(n[t])return n[t].exports;var e=n[t]={i:t,l:!1,exports:{}};return i[t].call(e.exports,e,e.exports,a),e.l=!0,e.exports}a.m=i,a.c=n,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(i,n,function(t){return e[t]}.bind(null,n));return i},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=0)}([function(t,e,i){"use strict";var n,a=i(1),r=(n=a)&&n.__esModule?n:{default:n};document.getElementById("button").onclick=function(){document.getElementById("model").style.display="none"};var o=new PIXI.loaders.Loader;o.add(["map/1.jpg","map/mapline.png","map/player.png"]).onProgress.add(function(){}),o.load(function(){new r.default})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t,e,i){return e&&a(t.prototype,e),i&&a(t,i),t};function a(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var r,c=i(2),o=i(3),s=(r=o)&&r.__esModule?r:{default:r};var h=(n(u,[{key:"initGame",value:function(){this.prevLine=0,this.currentLine=0,this.nextLine=1,this.GameState="drawLine",this.moveData.v=1,this.moveData.a=0,this.moveData.afterFuture=0,this.moveData.future=0,this.moveData.after=0,this.moveData.next=0,this.moveData.last=0,this.moveData.curr=0,this.startMove=!1,this.line.visible=!0,this.startLine=!1,this.outSide=!1,this.lineIndexArr=[],this.linePath=[],this.line.clear(),this.currentPoint.position.set(566,770),this.DisplayLine.reset()}},{key:"dispatchEvent",value:function(){var i=this;this.app.stage.on("collision",function(t){var e=t.lineIndex;i.nextLine!=e?i.prevLine=e:(i.currentLine=e,i.nextLine=e+1)}),this.app.stage.on("move",function(){i.line.visible=!1,i.startMove=!0,i.GameState="move"}),this.app.stage.on("gameInit",function(){i.initGame()})}},{key:"movePath",value:function(){var t=this.linePath;this.moveData.v=this.moveData.v+this.moveData.a,this.moveData.v=Math.max(this.moveData.min,Math.min(this.moveData.v,this.moveData.max)),this.moveData.next=this.moveData.curr+1,this.moveData.after=this.moveData.next+1,this.moveData.after>=t.length&&(this.moveData.after%=t.length),this.moveData.future=this.moveData.curr+4,this.moveData.future>=t.length&&(this.moveData.future%=t.length),this.moveData.afterFuture=this.moveData.curr+5,this.moveData.afterFuture>=t.length&&(this.moveData.afterFuture%=t.length);var e=t[this.moveData.next],i=t[this.moveData.curr],n=(t[this.moveData.after],t[this.moveData.future]),a=t[this.moveData.afterFuture],r=(0,c.getAngle2)(i.x,i.y,e.x,e.y)+90,o=(r%=360)*Math.PI/180-this.carSprite.rotation;this.carSprite.rotation+=1*o;var s=this.carSprite.x+this.moveData.v*Math.sin(r*Math.PI/180),h=this.carSprite.y-this.moveData.v*Math.cos(r*Math.PI/180),u=(0,c.getAngle2)(n.x,n.y,a.x,a.y)+90-180*this.carSprite.rotation/Math.PI;if(u=u*Math.PI/180,this.moveData.a=1*(Math.cos(u)-.6),0<this.moveData.a?this.moveData.a*=1:this.moveData.a*=2,(0,c.distance)(e,i)>(0,c.distance)({x:s,y:h},i))return this.carSprite.x+=.05*(s-this.carSprite.x),void(this.carSprite.y+=.05*(h-this.carSprite.y));this.carSprite.x=e.x,this.carSprite.y=e.y,this.moveData.last=this.moveData.curr,this.moveData.curr=this.moveData.next}},{key:"addEvent",value:function(){var n=this;this.background.interactive=!0,this.background.on("touchstart",function(t){if("move"!=n.GameState){var e=t.data.global.x,i=t.data.global.y;0<n.linePath.length?n.checkDistance(e,i,20)&&(n.startLine=!0):n.containPoint(e,i)&&Math.abs(e-633)<61&&Math.abs(i-768)<30&&(n.startLine=!0,n.linePath.push({x:e,y:i}))}}).on("touchmove",function(t){if("move"!=n.GameState){var e=t.data.global.x,i=t.data.global.y;0<n.linePath.length&&n.startLine&&(n.containPoint(e,i)?n.outSide?n.checkDistance(e,i,10)&&(n.drawLine(e,i),n.outSide=!1):n.drawLine(e,i):n.outSide=!0)}}).on("touchend",function(){n.startLine=!1,n.outSide=!1})}},{key:"animate",value:function(){for(var t=this,e=this.DisplayLine.children,i=0;i<e.length;i++)this.hitBox(e[i],this.currentPoint)&&this.app.stage.emit("collision",e[i]);if(5==this.currentLine&&-1==[2,5].indexOf(this.prevLine))this.app.stage.emit("move"),this.prevLine=0,this.currentLine=0,this.nextLine=1,this.currentPoint.position.set(566,770);else if(-1!=[0,1,2,5].indexOf(this.prevLine)){var n=this.currentPoint.x,a=this.currentPoint.y;500<n&&n<700&&778<=a&&a<900&&(document.getElementById("model").style.display="block",this.app.stage.emit("gameInit"))}this.startMove&&this.moveData.curr<this.linePath.length-1&&this.movePath(),requestAnimationFrame(function(){t.animate()})}},{key:"hitBox",value:function(t,e){return!(t.y+t.height<e.y||t.y>e.y+e.height||t.x+t.width<e.x||t.x>e.x+e.width)}},{key:"drawLine",value:function(t,e){if(!this.checkDistance(t,e,15)){this.currentPoint.position.set(t,e);var i=this.linePath.length-1,n=(this.linePath[i].x,this.linePath[i].y,{x:t,y:e});this.linePath.push(n),this.line.clear(),this.line.lineStyle(20,2817792,1);for(var a=0;a<this.linePath.length;a++)this.line[0==a?"moveTo":"lineTo"](this.linePath[a].x,this.linePath[a].y)}}},{key:"containPoint",value:function(t,e){return 0!=this.mapLine.canvasCtx.getImageData(t,e,1,1).data[3]}},{key:"checkDistance",value:function(t,e,i){var n=this.linePath[this.linePath.length-1];return!(Math.abs(n.x-t)>i||Math.abs(n.y-e)>i)}}]),u);function u(t,e){var i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),this.viewW=t||window.innerWidth,this.viewH=e||window.innerHeight,this.app=new PIXI.Application({width:this.viewW,height:this.viewH,antialias:!0,transparent:!0,forceCanvas:!0}),document.body.appendChild(this.app.renderer.view),this.background=new PIXI.Sprite.fromImage("map/1.jpg"),this.carSprite=new PIXI.Sprite.fromImage("map/player.png"),this.carSprite.scale.set(.5,.5),this.carSprite.anchor.set(.5,.5),this.mapLine=new PIXI.Sprite.fromImage("map/mapLine.png"),this.sence=new PIXI.Container,this.countLine=new PIXI.Container,this.line=new PIXI.Graphics,this.line.lineStyle(20,16777215,1),this.countLine.addChild(this.line),this.currentPoint=new PIXI.Graphics,this.currentPoint.beginFill(11141307,1),this.currentPoint.drawRect(0,0,20,20),this.currentPoint.endFill(),this.currentPoint.position.set(566,770),this.currentPoint.visible=!1,this.countLine.addChild(this.currentPoint),this.sence.addChild(this.mapLine,this.background,this.carSprite,this.countLine),this.app.stage.addChild(this.sence),setTimeout(function(){i.mapLine.canvasCtx=i.app.renderer.plugins.extract.canvas(i.mapLine).getContext("2d")},0),this.DisplayLine=new s.default,this.DisplayLine.hideChildren(!1),this.sence.addChild(this.DisplayLine),this.moveData={afterFuture:0,future:0,after:0,next:0,last:0,curr:0,v:1,a:0,request:0},this.GameState="drawLine",this.linePath=[],this.startLine=!1,this.outSide=!1,this.lineIndexArr=[],this.startMove=!1,this.prevLine=0,this.currentLine=0,this.nextLine=1,this.addEvent(),this.animate(),this.dispatchEvent()}e.default=h},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getAtan2=function(t,e){return Math.atan2(t.y-e.y,t.x-e.x)},e.getAngle=function(t,e){var i=e.x-t.x,n=e.y-t.y,a=Math.acos(n/Math.sqrt(i*i+n*n));return 0<=i&&0<=n?a=2*Math.PI-a:0<=i&&n<=0&&(a=2*Math.PI-a),a},e.getLen=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},e.isContinuityArray=function(t){for(var e=!1,i=t.length-1,n=0;n<i;n++){var a=Number(t[n])+1,r=Number(t[n+1]);if(n+1==i&&(a=Number(t[n]),r=Number(t[n])),a!=r){e=!1;break}e=!0}return e},e.getAngle2=function(t,e,i,n){var a=i-t,r=n-e,o=Math.sqrt(Math.pow(a,2)+Math.pow(r,2)),s=a/o,h=Math.acos(s),u=180/(Math.PI/h);r<0?u=-u:0==r&&a<0&&(u=180);return u},e.distance=function(t,e){return Math.sqrt(Math.pow(e.y-t.y,2)+Math.pow(e.x-t.x,2))}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t};function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var a=(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(r,PIXI.Container),i(r,[{key:"reset",value:function(){for(var t=this.children,e=0;e<t.length;e++)t[e].ishit=!1}},{key:"hideChildren",value:function(t){for(var e=t,i=this.children,n=0;n<i.length;n++)i[n].visible=e}},{key:"createHitbox",value:function(t,e,i,n,a,r){var o=new PIXI.Graphics;return o.beginFill(r),o.drawRect(0,0,i,n),o.endFill(),o.lineIndex=a,o.ishit=!1,o.position.set(t,e),this.addChild(o),o}}]),r);function r(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r);var t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return t.createHitbox(566,700,140,20,1,3525722),t.createHitbox(284,712,20,180,2,16706423),t.createHitbox(294,702,180,20,3,6621786),t.createHitbox(284,532,20,180,4,3525722),t.createHitbox(566,794,140,20,5,3525722),t}e.default=a}]);